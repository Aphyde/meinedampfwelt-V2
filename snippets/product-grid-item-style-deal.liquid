{%- liquid
  assign on_sale = false
  if product.compare_at_price_min > product.price_min
    assign on_sale = true
  endif
  assign option_color_swatch = settings.option_color_swatch | downcase
  for option in product.options_with_values
      assign option_name = option.name | downcase
      if option_color_swatch contains option_name
        assign product_option = option
        assign index = forloop.index0
        assign position = forloop.index | minus: 1
        break
      else
        assign position = 0
      endif
  endfor

  assign available = product.variants.first.available
  
  if settings.lang_iso_rtl != blank
    assign list_iso_rtl = settings.lang_iso_rtl | downcase
    if list_iso_rtl contains request.locale.iso_code
      assign iso_rtl = true
    else
      assign iso_rtl = false
    endif
  endif
-%}
<div class="item-product mb-0{% if settings.show_border_product %} h_bd{% endif %}{% if settings.show_background_product %} bg{% endif %}" data-product-id="product-{{ product.id }}" data-json-product='{"id": {{product.id}},"handle": "{{product.handle}}","variants": {{ product.variants | json | escape }},"media": {{product.media | json}}}'>
  <div class="inner-top d-sm-flex align-items-center">
    <div class="product-left">
      <div class="thumbnail-container{% if product.images.size > 1 %} has-multiimage{% endif %}">
        <a href="{{ product.url | within: collection }}" data-index="0">
          {% assign img_url = product.featured_image %}
          <div class="respone_image" style="padding-top:{{ 1 | divided_by: img_url.aspect_ratio | times: 100}}%;">
        <img class="product__thumbnail lazyload" src="{{ img_url | image_url: width: 1 }}" data-src="{{ img_url | image_url: width: 260 }}" data-srcset="{{ img_url | image_url:width: 260 }} 260w,{{ img_url | image_url: width: 360 }} 360w,{{ img_url | image_url: width: 540 }} 540w,{{ img_url | image_url: width: 720 }} 720w,{{ img_url | image_url: width: 900 }} 900w,{{ img_url | image_url: width: 1080 }} 1080w" data-sizes="auto" alt="{{ img_url.alt }}" width="{{ img_url.width }}" height="{{ img_url.height }}" loading="lazy" style="height: auto;">
            {% for image in product.images %}
              {% assign img_url = image.src %}
              {% if forloop.first != true %}
            <img class="product__thumbnail-second lazyload" src="{{ img_url | image_url: width: 1 }}" data-src="{{ img_second | image_url: width: 260 }}" data-srcset="{{ img_url | image_url:width: 260 }} 260w,{{ img_url | image_url: width: 360 }} 360w,{{ img_url | image_url: width: 540 }} 540w,{{ img_url | image_url: width: 720 }} 720w,{{ img_url | image_url: width: 900 }} 900w,{{ img_url | image_url: width: 1080 }} 1080w" data-sizes="auto" alt="{{ img_url.alt }}" width="{{ img_url.width }}" height="{{ img_url.height }}" loading="lazy" style="height: auto;">
                {% break %}
              {% endif %}
            {% endfor %}
          </div>
        </a>
        {% assign date_created = product.created_at | date:'%s' %}
        {% assign date_now = 'now' | date:'%s' %}
        {% assign difference = date_now | minus: date_created %}
        {% assign date_end = settings.time_newproduct | times: 86400 %}
        <div class="product--badge">
          {% if difference < date_end and settings.show_badge_new_product %}
            <div class="badge badge-new">{{ 'products.product.new' | t }}</div>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="product-right">
      <div class="product__info">
        {% if settings.product_type %}
          <div class="product__type text-uppercase font-700">{{ product.type | link_to_type }}</div>
        {% endif %}
        {% if settings.show_rating %}
          <div class="AirReviews-Widget AirReviews-Widget--Stars" data-review-avg="{{ product.metafields.air_reviews_product.review_avg }}" data-review-count="{{ product.metafields.air_reviews_product.review_count }}"></div>
        {% endif %}
        <div class="product__title"><a href="{{ product.url | within: collection }}"><span>{{ product.title }}</span></a></div>
        <div class="price-box mt-10 price-st">
          {% if on_sale %}
            <div class="price-sale d-flex flex-wrap align-items-center">
              <span class="special-price" data-price-grid>{{ product.variants[0].price | money }}</span>
              <span class="old-price" data-compare-price-grid>{{ product.variants[0].compare_at_price | money }}</span>
              <span class="badge badge-sale">-{{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price | round: 4 }}%</span>
            </div>
          {% else %}
            <div class="price-regular">
              <span data-price-grid>{{ product.variants[0].price | money }}</span>
            </div>
          {% endif %}
        </div>
      </div>
      <div class="countdownfree d-flex mt-30" data-countdown="{{ countdown_timeend }}" data-show-days="{{ settings.show_day }}" data-restart="{{ settings.restart }}"></div>
      {%- assign product_start_count = product.metafields.stock.initial | times:1 -%}
      {% if product.metafields.stock.initial != blank and section.settings.enable_progress %}
        <div class="deal-flash__sale mt-30">
          {% if product.variants.size < 2 %}
            {%- assign available = product.selected_or_first_available_variant.inventory_quantity -%}
            {%- assign sold = product_start_count | minus:available | times: 100 | divided_by : product_start_count -%}
                <div class="deal-flash__sale-progress position-relative" style="background-color: {{ settings.progress_deal }}">
                  <div class="progress__bar position-absolute" style="width: {{ sold }}%;background: {% if settings.enable_rtl and iso_rtl %}{{ settings.gradient_deal | replace: '90deg', '-90deg' }}{% else %}{{ settings.gradient_deal }}{% endif %}"></div>
                </div>
                <div class="flash__sale-bottom mt-15">
                  {{ 'sections.product_deals.progress_html' | t: sold: sold, available: available }}
                </div>
          {% elsif product.variants.size > 1 %}
            {% assign available = 0 %}
            {% for variant in product.variants %}
              {% assign available = available | plus: variant.inventory_quantity %}
            {% endfor %}
                {%- assign sold = product_start_count | minus:available | times: 100 | divided_by : product_start_count -%}
                <div class="deal-flash__sale-progress position-relative" style="background-color: {{ settings.progress_deal }}">
                  <div class="progress__bar position-absolute" style="width: {{ sold }}%;background: {% if settings.enable_rtl and iso_rtl %}{{ settings.gradient_deal | replace: '90deg', '-90deg' }}{% else %}{{ settings.gradient_deal }}{% endif %}"></div>
                </div>
                <div class="flash__sale-bottom mt-15">
                  {{ 'sections.product_deals.progress_html' | t: sold: sold, available: available }}
            </div>
          {% endif %}
        </div>
      {% endif %}
      {% render 'item-swatch', product: product, option_color_swatch: option_color_swatch, downcased_option: option_name, product_option: product_option, index: index %}
      {% if settings.addtocart_enable %}
        <div class="product__popup-swatch">
          {% render 'add-to-cart-form', product: product, id: 'grid-product-form-', position: position, section_id: section_id, blockId: blockId %}
        </div>
      {% endif %}
    </div>
  </div>
</div>